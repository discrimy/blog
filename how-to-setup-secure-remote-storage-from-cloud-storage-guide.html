<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>How to setup secure remote storage from cloud storage (guide)</title>
        <link rel="stylesheet" href="https://discrimy.github.io/theme/css/main.css" />
        <link href="https://discrimy.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Bespealex's Blog Atom Feed" />
        <meta name="description" content="How to setup secure remote storage from cloud storage (guide) I thought about secure encrypted file storage for a long time. Most cloud providers..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://discrimy.github.io/">Bespealex's Blog</a></h1>
                <nav><ul>
                    <li><a href="https://discrimy.github.io/pages/about-me.html">About me</a></li>
                    <li class="active"><a href="https://discrimy.github.io/category/misc.html">misc</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://discrimy.github.io/how-to-setup-secure-remote-storage-from-cloud-storage-guide.html" rel="bookmark"
           title="Permalink to How to setup secure remote storage from cloud storage (guide)">How to setup secure remote storage from cloud storage (guide)</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2023-08-14T23:23:00+03:00">
                Published: Пн 14 августа 2023
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://discrimy.github.io/author/alexander-bespalov.html">Alexander Bespalov</a>
        </address>
<p>In <a href="https://discrimy.github.io/category/misc.html">misc</a>.</p>

</footer><!-- /.post-info -->      <h1>How to setup secure remote storage from cloud storage (guide)</h1>
<p>I thought about secure encrypted file storage for a long time. Most cloud providers doesn't encrypt file, so that means your files are not only yours but provider's too. Some providers which states they store files encrypted (like Mega) have bad CLI tools for automation and Android applicatons.</p>
<p>I wrote down criterias which ideal solution must satisfy:
- Client-side encryption of files (server mustn't has access to original files)
- Standart API like WebDAV and SFTP
- Large volume (hunders of GB)
- Reliably, in ideal case provider must manage it by itself
- Fully open source (because I don't believe in tales)</p>
<p>I found great tool named <a href="https://rclone.org">rclone</a> and there was a sale for Yandex.Disk 2TB disk, so I had everything I needed to make the storage.</p>
<h2>How it works</h2>
<p><img alt="" src="/images/secure-storage-guide_how-it-works.svg"></p>
<p>Yandex.Disk (or any provider you like, rclone supports a lot of providers) stores encrypted files. Personal server hosts rclone server which serves as proxy to Yandex.Disk and handles encryption and descryption on fly. All clients connect to this server via standart protocols like WebDAV.</p>
<h2>How to setup</h2>
<h3>Setup encryption on top of cloud</h3>
<ol>
<li>Run <code>rclone config</code> and create new remote (remote is how rclone names storages) for your cloud provider, let's name it as <code>external</code>.</li>
<li>Create new remote with type <code>crypt</code>, as <code>Option remote</code> set <code>external:some-folder</code> (directory must be empty), set <code>password</code> and <code>password2</code>, let's name this remote as <code>external-encr</code>. Save config file (you can find it with <code>rclone config file</code>) and save it to secure place, because without it you cannot restore files.</li>
<li>Check<ol>
<li><code>rclone copy file.jpg external-encr:file.jpg</code> - copy file to encrypted remote</li>
<li><code>rclone ls external-encr:</code> - list files inside remote</li>
<li><code>rclone copy external-encr:file.jpg file-copy.jpg</code> - download file from remote</li>
</ol>
</li>
</ol>
<h3>Setup WebDAV and SFTP servers</h3>
<p>To interact with storage via standart protocols we setup rclone server. Choose protocol by their speed, WebDAV is better for me.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Run WebDAV server on port 8080, authenticate user `username` with password `password`</span>
rclone<span class="w"> </span>serve<span class="w"> </span>webdav<span class="w"> </span>external-encr:<span class="w"> </span>--addr<span class="w"> </span>:8080<span class="w"> </span>--user<span class="w"> </span>username<span class="w"> </span>--pass<span class="w"> </span>password
</code></pre></div>

<p>Replace <code>webdav</code> with <code>sftp</code> if SFTP is needed. Also consider to add:
- <code>--vfs-cache-mode full</code> - use cache
- <code>--vfs-cache-max-size 1G</code> - set cache max size</p>
<p>It's a bad practice to set user password in command because command will be saved to your history. It's better to set them via environment variables <code>RCLONE_USER</code> and <code>RCLONE_PASS</code>.</p>
<h2>How to use</h2>
<h3>CLI</h3>
<p>You can use <code>rclone</code> itself to interact with your storage using <code>external-encr</code> remote for direct access or create new remote with type <code>webdav</code> to your proxy server to interact via it.</p>
<h3>Android</h3>
<p>There is good file manager <a href="https://play.google.com/store/apps/details?id=pl.solidexplorer2&amp;pli=1">Solid Explorer</a> (it's partially paid, but it's worth it), and this app can connect to WebDAV or SFTP server.</p>
<h3>Linux (KDE)</h3>
<p>KDE Dolphin has good WebDAV support.</p>
<h3>Windows</h3>
<p>I don't managed to find good open source file manager with WebDAV support, and builtin File Explorer behaves strangely. But <code>rclone</code> can mount remote as a drive! You can write simple script to run command to mount and use it as local storage.</p>
<div class="highlight"><pre><span></span><code><span class="gh">#</span> Mount storage as drive N:
<span class="gh">#</span> It&#39;s recommended to add caching (--vfs-*)
rclone mount external-encr: n:
</code></pre></div>

<h3>Web</h3>
<p><a href="https://www.filestash.app">Filestash</a> is good web application to access WebDAV server. You can self-host it on the same server and connect to storage via Filestash, I use it on desktop.</p>
<h2>Known issues</h2>
<p>Listing folder with a lot of files inside (tens for thousands) can take a lot of time, but I think it's provider issue, and this doesn't break anything.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://discrimy.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>