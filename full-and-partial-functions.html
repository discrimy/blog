<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>"Full and Partial Functions"</title>
        <link rel="stylesheet" href="https://discrimy.github.io/theme/css/main.css" />
        <link href="https://discrimy.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Bespealex's Blog Atom Feed" />
        <meta name="description" content="Full and partial functions Functions in programming can be splitted into two categories: 1. Partial function - there is at least one combination..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://discrimy.github.io/">Bespealex's Blog</a></h1>
                <nav><ul>
                    <li><a href="https://discrimy.github.io/pages/about-me.html">About me</a></li>
                    <li class="active"><a href="https://discrimy.github.io/category/misc.html">misc</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://discrimy.github.io/full-and-partial-functions.html" rel="bookmark"
           title="Permalink to "Full and Partial Functions"">"Full and Partial Functions"</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2023-05-08T20:29:03+03:00">
                Published: Пн 08 мая 2023
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://discrimy.github.io/author/alexander-bespalov.html">Alexander Bespalov</a>
        </address>
<p>In <a href="https://discrimy.github.io/category/misc.html">misc</a>.</p>

</footer><!-- /.post-info -->      <h2>Full and partial functions</h2>
<p>Functions in programming can be splitted into two categories:
1. Partial function - there is at least one combination of arguments that has no defined result. Usually it leads to undefined behaviour or raised exception
<img alt="" src="/images/full-and-partial-functions-partial.png"></p>
<div class="highlight"><pre><span></span><code><span class="c1"># What if `raw_number` cannot be parsed to integer? ValueError will be raised, but it&#39;s implicit result</span>
<span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">raw_number</span><span class="p">)</span>
</code></pre></div>

<ol>
<li>Full function - every possible combination of arguments has it's own result or action:
<img alt="" src="/images/full-and-partial-functions-full.png"></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1"># the function returns either int or None explicitly</span>
<span class="k">def</span> <span class="nf">int_or_none</span><span class="p">(</span><span class="n">raw</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>

<h2>How partial function can be converted to full?</h2>
<p>It's hard to work with partial functions. You can't trust their contract (input and output types), so you have to read through it's source to make what it can make for undefined inputs, what kind of side effects produces and which exceptions rises. Let's take an example:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># that if `email` is not valid email?</span>
<span class="c1"># `delete_older_than` must has a format &#39;YYYY-MM-DD&#39;, but what if it&#39;s not?</span>
<span class="k">def</span> <span class="nf">cleanup_email_folder</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">delete_older_than</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>

<h3>Weaking result type</h3>
<p>We can map undefined input combinations to different input type like <code>None</code> or <code>Result[Error]</code>. </p>
<div class="highlight"><pre><span></span><code><span class="c1"># returns `ValueError` if `email` or `delete_older_than` have incorrect format</span>
<span class="k">def</span> <span class="nf">cleanup_email_folder</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">delete_older_than</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">]:</span>
    <span class="o">...</span>
</code></pre></div>

<p>It's a simple solution, but has some problems:
1. We should don't forget to check return type of function. In this example, it's easy to just call it and don't check the result.
2. That if caller already checked provided arguments elsewhere? In this case, function's checks become redundant.
3. The command is responsible for checking input arguments checking and the cleanuping itself.</p>
<h3>Strengthing input types</h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Email</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chech_is_valid_email</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>

<span class="c1"># the function recieves `Email` instance, so it can be sure it&#39;s valid email</span>
<span class="c1"># `delete_older_than` is `datetime`, so the function can format it inside and can be sure it&#39;s actually some point in time</span>
<span class="k">def</span> <span class="nf">cleanup_email_folder</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="n">Email</span><span class="p">,</span> <span class="n">delete_older_than</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>

<p>Strengthing input types means eliminating undefined input arguments, so function can't be called using them. Usually it accomplished using more specific type or creating custom type that can be created if all checks passed already.</p>
<p>The second appoach solves all three problems of previous solution:
1. Caller cannot forget to check input arguments because instance of specific instance is a proof the argument is correct.
2. Caller can create instance somewhere in the code and use it any times, so there is no check duplication
3. The function itself is no longer responsible for format checking argument's correctness.</p>
<p>But this way of converting partial functions to full has it's own disadvantage. Sometimes it's hard to split value checking from it's actual usage. For example, <code>email</code> can doesn't exist in email server, so we can combine both methods to make function full and more explicit:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># we state the function can returns `EmailServerError` explicitly</span>
<span class="k">def</span> <span class="nf">cleanup_email_folder</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="n">Email</span><span class="p">,</span> <span class="n">delete_older_than</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">EmailServerError</span><span class="p">]:</span>
    <span class="o">...</span>
</code></pre></div>

<h2>Sources</h2>
<ul>
<li><a href="https://lexi-lambda.github.io/blog/2019/11/05/parse-don-t-validate/">Original article, gives explanations on context of Haskell</a></li>
</ul>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://discrimy.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>